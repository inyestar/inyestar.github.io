---
layout: default
title: 1 Day
parent: ALONE
---

# 2021ë…„ 11ì›” 15ì¼

## NOTE
- CI/CD
  - Github Actionì„ ì“¸ ê²½ìš° Docker Local Repository ì‚¬ìš© ë¶ˆê°€
  - Jenkins ì„œë²„ëŠ” ë¡œì»¬ì—ì„œ ì‚¬ìš©ê°€ëŠ¥í•˜ë‹ˆê¹Œ Local Repository ì‚¬ìš© ê°€ëŠ¥
  - Steps
    - push to Github
    - mvn install in Jenkins
    - build docker image in Jenkins
    - push docker image to local Repository in Jenkins
    - publish ??

## PRACTICE
- Jenkins
  ```bash
  $ sudo docker network create jenkins
  $ sudo docker run \
        --name jenkins-docker \
        --rm \
        --detach \
        --privileged \
        --network jenkins \
        --network-alias docker \
        --env DOCKER_TLS_CERTDIR=/certs \
        --volume jenkins-docker-certs:/certs/client \
        --volume jenkins-data:/var/jenkins_home \
        --publish 2376:2376 \
        docker:dind \
        --storage-driver overlay2
  $ sudo vi Dockerfile
    -----
    FROM jenkins/jenkins:2.303.3-jdk11
    USER root
    RUN apt-get update && apt-get install -y lsb-release
    RUN curl -fsSLo /usr/share/keyrings/docker-archive-keyring.asc \
    https://download.docker.com/linux/debian/gpg
    RUN echo "deb [arch=$(dpkg --print-architecture) \
    signed-by=/usr/share/keyrings/docker-archive-keyring.asc] \
    https://download.docker.com/linux/debian \
    $(lsb_release -cs) stable" > /etc/apt/sources.list.d/docker.list
    RUN apt-get update && apt-get install -y docker-ce-cli
    USER jenkins
    RUN jenkins-plugin-cli --plugins "blueocean:1.25.1 docker-workflow:1.26"
    -----
  $ sudo docker build -t myjenkins-blueocean:1.1 .
  $ sudo docker run \
        --name jenkins-blueocean \
        --rm \
        --detach \
        --network jenkins \
        --env DOCKER_HOST=tcp://docker:2376 \
        --env DOCKER_CERT_PATH=/certs/client \
        --env DOCKER_TLS_VERIFY=1 \
        --publish 8080:8080 \
        --publish 50000:50000 \
        --volume jenkins-data:/var/jenkins_home \
        --volume jenkins-docker-certs:/certs/client:ro \
        myjenkins-blueocean:1.1
  # ${IP}:8080ìœ¼ë¡œ ì ‘ì†
  # admin password ì…ë ¥
  $ sudo docker exec jenkins-blueocean cat /var/jenkins_home/secrets/initialAdminPassword
  # installation ì§„í–‰
  ```
  ğŸ’¡ Dockerì•ˆì— Dockerê°€ ì™œ ë– ìˆì–´ì•¼ í•˜ëŠ”ì§€ ì˜ë¬¸ì´ë‹¤. ê³µì‹ ë¬¸ì„œì— ì˜í•˜ë©´ docker-cliê°€ ê³µì‹ jenkins ì´ë¯¸ì§€ì— í¬í•¨ë˜ì–´ ìˆì§€ ì•Šê³  ë¸”ë£¨ì˜¤ì…˜ í”ŒëŸ¬ê·¸ì¸ì„ ì‚¬ìš©í•˜ê¸° ìœ„í•´ì„œë¼ê³  í•˜ëŠ”ë° ë¸”ë£¨ ì˜¤ì…˜ì´ ë­”ì§€ ëª¨ë¥´ê³  docker-cliê°€ ì™œ í•„ìš”í•œì§€ ëª¨ë¥´ê² ë‹¤.
- Docker Local Repository
  ```bash
  $ sudo docker run -d \
        -p 5000:5000 \
        --restart=always \
        --name inminhub \
        -v inminhub:/var/lib/registry \
        --network jenkins
        registry:2
  ```

## REFERENCES
- Jenkins
  - https://www.jenkins.io/doc/book/installing/docker/
